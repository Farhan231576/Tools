<!doctype html>
<html lang="id" data-bs-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Undian Spin Wheel</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    :root{--wheel-size:540px;--panel-w:420px;}
    html,body{height:100%;}
    body{overflow:hidden;}
    .app-wrap{height:100dvh;display:grid;grid-template-columns:1fr var(--panel-w);grid-template-rows:auto 1fr;grid-template-areas:"toolbar toolbar""stage side";}
    @media(max-width:992px){body{overflow:auto}.app-wrap{grid-template-columns:1fr;grid-template-rows:auto auto auto;grid-template-areas:"toolbar""stage""side";height:auto}}
    .toolbar{grid-area:toolbar;border-bottom:1px solid var(--bs-border-color);}
    .stage{grid-area:stage;display:grid;place-items:center;padding:8px}
    .side{grid-area:side;border-left:1px solid var(--bs-border-color);overflow:auto}
    .wheel-wrap{display:grid;place-items:center;width:100%}
    .wheel-outer{position:relative;aspect-ratio:1/1;max-width:min(90vw,var(--wheel-size));}
    canvas#wheel{width:100%;height:100%}
    .pointer{position:absolute;inset:0;display:grid;place-items:center;pointer-events:none}
    .pointer svg{width:68px;height:68px;filter:drop-shadow(0 2px 6px rgba(0,0,0,.25))}
    .table-preview{max-height:200px;overflow:auto;border:1px solid var(--bs-border-color);border-radius:6px;margin-top:.5rem}
  </style>
</head>
<body>
<div class="app-wrap">
  <div class="toolbar py-2 px-3 d-flex align-items-center gap-2 flex-wrap">
    <div class="me-auto fw-semibold">Undian Spin Wheel</div>
    <button id="btnSpin" class="btn btn-primary px-4 fw-semibold" disabled>SPIN</button>
  </div>

  <div class="stage">
    <div class="wheel-wrap">
      <div class="wheel-outer">
        <canvas id="wheel" width="1000" height="1000"></canvas>
        <div class="pointer">
          <svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="18" fill="#fff" stroke="#000"/><path d="M50 2 L58 22 L42 22 Z" fill="#dc3545" stroke="#000"/></svg>
        </div>
      </div>
    </div>
  </div>

  <div class="side p-3">
    <div class="mb-3">
      <label class="form-label fw-semibold">Peserta (.xlsx/.csv)</label>
      <input type="file" id="filePeserta" accept=".xlsx,.csv" class="form-control mb-2">
      <div id="previewPeserta" class="table-preview"></div>
    </div>
    <div class="mb-3">
      <label class="form-label fw-semibold">Hadiah (.xlsx/.csv)</label>
      <input type="file" id="fileHadiah" accept=".xlsx,.csv" class="form-control mb-2">
      <div id="previewHadiah" class="table-preview"></div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script>
const wheel=document.getElementById('wheel');const ctx=wheel.getContext('2d');let state={participants:[],prizes:[]};function drawWheel(){ctx.clearRect(0,0,1000,1000);ctx.beginPath();ctx.arc(500,500,480,0,2*Math.PI);ctx.fillStyle='#f8f9fa';ctx.fill();}
function renderPreview(id,data,headers){const wrap=document.getElementById(id);if(!data.length){wrap.innerHTML='<small class="text-secondary">Belum ada data</small>';return;}let html='<table class="table table-sm table-striped align-middle mb-0"><thead><tr>'+headers.map(h=>`<th>${h}</th>`).join('')+'</tr></thead><tbody>';for(const row of data){html+='<tr>'+headers.map(h=>`<td>${row[h]??''}</td>`).join('')+'</tr>';}html+='</tbody></table>';wrap.innerHTML=html;}
async function parseFile(f){const ext=f.name.split('.').pop().toLowerCase();const buf=await f.arrayBuffer();if(ext==='csv'){const text=new TextDecoder().decode(buf);const lines=text.split(/\r?\n/).filter(Boolean);const header=lines.shift().split(',');return lines.map(l=>{const parts=l.split(',');const o={};header.forEach((h,i)=>o[h.trim()]=parts[i]?.trim()||'');return o;});}const wb=XLSX.read(buf,{type:'array'});const ws=wb.Sheets[wb.SheetNames[0]];return XLSX.utils.sheet_to_json(ws,{defval:''});}
filePeserta.addEventListener('change',async e=>{const f=e.target.files[0];if(!f)return;const data=await parseFile(f);state.participants=data;renderPreview('previewPeserta',data,['NPK','Nama','Department']);});
fileHadiah.addEventListener('change',async e=>{const f=e.target.files[0];if(!f)return;const data=await parseFile(f);state.prizes=data;renderPreview('previewHadiah',data,['NamaHadiah','Jumlah','WarnaHex']);});
window.addEventListener('load',drawWheel);
</script>
</body>
</html>
